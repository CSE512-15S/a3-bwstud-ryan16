<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>A3</title>

  <style>
    html, body { width: 100%; height: 100%; margin: 0; } 
   
    .pt {
      fill: red;
    }

    #vis {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      height: 100%;
      width: 100%;
      background-color: black;
    }

    .orbit {
      fill: none;
      stroke: rgba(0, 255, 255, 0.25);
    }

    .sun {
      fill: yellow;
    }

    .distance-axis {
      opacity: 0.25;
    }

    .distance-axis text {
      fill: white;
    }

    .distance-axis .tick line {
      stroke: white;
      stroke-width: 1px;
    }

    .distance-axis .domain { stroke: white; fill: none; }
  </style>
</head>
<body>
  <svg id="vis"></svg>
  <script src="lib/d3.min.js"></script>
  <script src="lib/timbre.js"></script>
  <script>
    var notes = ['A', 'A#/Bb', 'B', 'C', 'C#/Db', 'D', 'D#/Eb', 'E', 'F', 'F#/Gb', 'G', 'G#/Ab'];    
    var note = function(freq) {
      return notes[(Math.round(12*(Math.log(freq/440) / Math.log(2))))%12];
    }



    console.log(note(1232));

    var synth = T("OscGen", {wave:"sin", mul:0.5});

    // T("interval", {interval: 300, timeout:"5sec"}, function() {
    //     synth.noteOnWithFreq(400, 80);
    // }).on("ended", function() {
    //     this.stop();
    // }).set({buddies:synth}).start();

    // T("interval", {interval: 400, timeout:"5sec"}, function() {
    //     synth.noteOnWithFreq(300, 80);
    // }).on("ended", function() {
    //     this.stop();
    // }).set({buddies:synth}).start();


    // T("interval", {interval: 100, timeout:"5sec"}, function() {
    //     synth.noteOnWithFreq(800, 80);
    // }).on("ended", function() {
    //     this.stop();
    // }).set({buddies:synth}).start();

    var sun = {r: 695500};
    var planets = [
      {"name":"Mercury", "ap": 69816900, "r": 2439.7, "color": "#999"},
      {"name":"Venus", "ap": 108939000, "r": 6051.8, "color": "#EA0"},
      {
        "name":"Earth",
        "ap": 151930000,
        "r": 6371.0,
        "color": "#03F",
        "moons": [
          {"name":"Moon (Luna)", "ap":405400, "r": 1737.10}
        ]
      },
      {"name":"Mars", "ap": 249.2e6, "r": 3389.5, "color": "#F00"},
      {"name":"Jupiter", "ap": 816520800, "r": 69911, "color": "#FA1"},
      {"name":"Saturn", "ap": 1513325783, "r": 58232, "color": "#FD1", "rings": true},
      {"name":"Uranus", "ap": 3006224700, "r": 25362, "color": "#0FF"},
      {"name":"Neptune", "ap": 4537580900, "r": 24622, "color": "#00F"}
    ];


    window.onload = function() {
      var RECT = document.getElementById("vis").getBoundingClientRect();
      var WIDTH = RECT.right - RECT.left;
      var HEIGHT = RECT.bottom - RECT.top;

      var zoom = Math.min(WIDTH/2, HEIGHT/2);

      console.log("w", WIDTH, "h", HEIGHT);

      var ap = function(d) { return d.ap; };

      var r = d3.scale.linear()
        .domain([0, sun.r])
        .range([1, 30]);

      var svg = d3.select("#vis")
        .append("g") // use a group to translate our coordinates to the center
          .attr("transform", "translate(" + WIDTH/2 + "," + HEIGHT/2 + ")");
      
      svg.append("circle")
        .datum(sun)
        .attr("class", "sun")
        .attr("r", function(d) { return r(d.r); })
        .attr("cx", 0)
        .attr("cy", 0);


      render();

      document.addEventListener("DOMMouseScroll", function(e) {
        if (e.detail < 0) {
          zoom /= 1.1;
        } else {
          zoom *= 1.1;
        }
        render();
      });

      document.addEventListener("mousemove", function(e) {
        // console.log(e.layerX);
      });

      
     

      function render() {
        var x = d3.scale.linear()
          .domain([sun.r, d3.max(planets, ap)])
          .range([r(sun.r), zoom]).nice();

        var xAxis = d3.svg.axis().scale(x).ticks(0, "e");

        var pts = svg.selectAll(".pt")
          .data(planets);

        // distance axis
        svg.select(".distance-axis")
            .attr("class", "distance-axis")
            .call(xAxis);

        // orbit lines
        function orbit(d) {
          d.attr("cx", 0)
          .attr("cy", 0)
          .attr("r", function(d) { return x(d.ap); })
          .attr("class", "orbit");
        }
        var orbits = svg.selectAll(".orbit").data(planets);
        orbits.call(orbit);
        orbits.enter().append("circle").call(orbit);
        orbits.exit().remove();

        // bodies
        function body(d) {
          var theta = Math.PI;
          d.attr("cx", function(d) { return Math.cos(theta)*x(d.ap); })
           .attr("cy", function(d) { return -Math.sin(theta)*x(d.ap); })
           .attr("r", function(d) { return r(d.r); })
           .attr("class", "pt")
           .attr("style", function(d) { return "fill:" + (d.color || "red"); });
        }
        
        pts.call(body);
        pts.enter().append("circle").call(body);
        pts.exit().remove();

        planet_targets = document.querySelectorAll(".pt");
        for(var i = 1;i<planet_targets.length;i++){
          planet_targets[i].addEventListener("click", piano);
        }

        // var piano = function(d){
        //   alert("hey");
        // // display keyboard
        // // determine key based on frequency
        // // append indicator above key
        //   d3.select("#vis")
        //     .data(notes)
        //     .enter()
        //     .append("rect")
        //     .attr({
        //       x: function(d, i){
        //         return 20*i;
        //       },
        //       y: function(d, i){
        //         return 0;
        //         //differentiate black and white keys
        //       },
        //       height: 100,
        //       width: 20,
        //       fill: "red"
        //       // text: function(d){
        //       //   return d;
        //       // }
        //     });
        // }

      }

      requestAnimationFrame(function frame() {
        // rendering
        

        requestAnimationFrame(frame);
      });
      var piano = function(d){
          alert("hey");
        // display keyboard
        // determine key based on frequency
        // append indicator above key
          d3.select("#vis")
            .data(notes)
            .enter()
            .append("rect")
            .attr({
              x: function(d, i){
                return 20*i;
              },
              y: function(d, i){
                return 0;
                //differentiate black and white keys
              },
              height: 100,
              width: 20,
              fill: "red"
              // text: function(d){
              //   return d;
              // }
            });
        }
    };
     

     

     var planet_targets;

      
     function ho(){
        alert("ho");
      }
      // var piano = function(d){
      //     alert("hey");
      //   // display keyboard
      //   // determine key based on frequency
      //   // append indicator above key
      //     d3.select("#vis")
      //       .data(notes)
      //       .enter()
      //       .append("rect")
      //       .attr({
      //         x: function(d, i){
      //           return 20*i;
      //         },
      //         y: function(d, i){
      //           return 0;
      //           //differentiate black and white keys
      //         },
      //         height: 100,
      //         width: 20,
      //         fill: "red"
      //         // text: function(d){
      //         //   return d;
      //         // }
      //       });
      //   }


      function display(){

      }
  </script>
</body>
</html>
